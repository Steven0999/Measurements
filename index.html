<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="theme-color" content="#0d6efd" />
  <link rel="manifest" href="manifest.json" />
  <title>Measurement Tracker PWA</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 1rem; }
    .card { border: 1px solid #ccc; padding: 1rem; margin-bottom: 1rem; border-radius: 8px; }
    .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); justify-content: center; align-items: center; }
    .modal-content { background: #fff; padding: 2rem; border-radius: 8px; width: 300px; }
    .modal.show { display: flex; }
  </style>
</head>
<body>
  <h1>Measurement Tracker</h1>
  <button onclick="openModal()">Add Measurements</button>

  <div id="modal" class="modal">
    <div class="modal-content">
      <h2>Enter Measurements</h2>
      <form id="measurementForm">
        <input type="file" accept="image/*" capture="environment" id="photo" /><br><br>
        <input type="number" placeholder="Shoulders (cm)" id="shoulders" /><br><br>
        <input type="number" placeholder="Chest (cm)" id="chest" /><br><br>
        <input type="number" placeholder="Arms (cm)" id="arms" /><br><br>
        <input type="number" placeholder="Abs (cm)" id="abs" /><br><br>
        <input type="number" placeholder="Glutes (cm)" id="glutes" /><br><br>
        <input type="number" placeholder="Thighs (cm)" id="thighs" /><br><br>
        <input type="number" placeholder="Calves (cm)" id="calves" /><br><br>
        <button type="submit">Save</button>
        <button type="button" onclick="closeModal()">Cancel</button>
      </form>
    </div>
  </div>

  <div id="entries"></div>

  <script>
    const modal = document.getElementById('modal');
    const form = document.getElementById('measurementForm');
    const entriesDiv = document.getElementById('entries');

    function openModal() { modal.classList.add('show'); }
    function closeModal() { modal.classList.remove('show'); }

    function saveEntry(entry) {
      const data = JSON.parse(localStorage.getItem('measurements') || '[]');
      data.push(entry);
      localStorage.setItem('measurements', JSON.stringify(data));
    }

    function loadEntries() {
      const data = JSON.parse(localStorage.getItem('measurements') || '[]');
      entriesDiv.innerHTML = '';
      data.forEach(entry => {
        const card = document.createElement('div');
        card.className = 'card';
        card.innerHTML = `
          <p><strong>Date:</strong> ${entry.date}</p>
          ${entry.photo ? `<img src="${entry.photo}" width="100" />` : ''}
          <p>Shoulders: ${entry.shoulders} cm</p>
          <p>Chest: ${entry.chest} cm</p>
          <p>Arms: ${entry.arms} cm</p>
          <p>Abs: ${entry.abs} cm</p>
          <p>Glutes: ${entry.glutes} cm</p>
          <p>Thighs: ${entry.thighs} cm</p>
          <p>Calves: ${entry.calves} cm</p>
        `;
        entriesDiv.appendChild(card);
      });
    }

    form.addEventListener('submit', e => {
      e.preventDefault();
      const photoInput = document.getElementById('photo');
      const reader = new FileReader();

      const entry = {
        date: new Date().toLocaleString(),
        shoulders: form.shoulders.value,
        chest: form.chest.value,
        arms: form.arms.value,
        abs: form.abs.value,
        glutes: form.glutes.value,
        thighs: form.thighs.value,
        calves: form.calves.value,
        photo: ''
      };

      if (photoInput.files.length > 0) {
        reader.onload = () => {
          entry.photo = reader.result;
          saveEntry(entry);
          loadEntries();
          closeModal();
        };
        reader.readAsDataURL(photoInput.files[0]);
      } else {
        saveEntry(entry);
        loadEntries();
        closeModal();
      }
    });

    window.onload = loadEntries;
  </script>

  <script>
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('sw.js').then(() => console.log('Service Worker Registered'));
    }
  </script>
</body>
</html>
